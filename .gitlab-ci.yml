image: docker:latest
services:
  - docker:20.10.7-dind
cache:
  paths:
    - .m2/repository/
    - target/
    - variable

stages:
  - build
  - test

build:
  stage: build
  image: maven:3-jdk-8
  script:
    - mvn clean package
  artifacts:
    paths:
      - target/
  only:
    - master

test:
  stage: test
  script:
    - docker build . -t code:latest
    - docker network create --subnet=172.12.0.0/16 container-network
    - docker run -d -p 4444:4444 --net=container-network --name=chromedebug  selenium/standalone-chrome-debug:3.141.59-oxygen
    - docker ps
    - docker network inspect container-network
    - docker run --net=container-network -v  $(pwd)/target/tests:/results --name=testcontainer code:latest
  artifacts:
    when: always
    paths:
      - target/
  only:
    - master
